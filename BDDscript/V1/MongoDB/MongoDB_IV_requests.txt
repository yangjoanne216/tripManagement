
//nom de database
use tripManagementDB 
//Quelles sont les activités associées à un point d’intérêt donné ?  poiId="507f191e810c19729de860ea"
//Methode 1 :
db.activity.find(
  { "pointOfInterest.id": ObjectId("507f191e810c19729de860ea") },
  {
    name:    1,
    photos:  1,
    seasons: 1,
    price:   1,
    _id:     0
  }
);

//Methode 2 :
db.pointOfInterest.aggregate([
  {
    $match: { _id: ObjectId("507f191e810c19729de860ea") }
  },
  {
    $lookup: {
      from:         "activity",
      localField:   "_id",
      foreignField: "pointOfInterest.id",
      as:           "activities"
    }
  },
  {
    $project: {
      _id:        0,
      poiName:    "$name",
      poiAddress: "$address",
      activities: {
        name:    1,
        seasons: 1,
        price:   1,
        photos:  1
      }
    }
  }
]);


//Quels sont les hébergements d’une ville ?

//Methode 1 :
const cityId = ObjectId("507f191e810c19729de860a1");
db.accommodation.find(
  { "city.id": cityId },
  {
    name:      1,
    address:   1,
    photos:    1,
    price:     1,
    available: 1,
    _id:       0
  }
);

// Methode 2 :
const cityId = ObjectId("507f191e810c19729de860a1");

db.city.aggregate([
  { 
    $match: { _id: cityId } 
  },
  {
    $lookup: {
      from:         "accommodation",    // collection à joindre
      localField:   "_id",              // _id de city
      foreignField: "city.id",          // champ embarqué dans accommodation
      as:           "hebergements"      // nom du tableau résultat
    }
  },
  {
    $project: {
      _id:           0,
      ville:         "$name",
      hebergements: {
        name:      1,
        address:   1,
        photos:    1,
        price:     1,
        available: 1
      }
    }
  }
]);

//Quelles activités se font entre avril et juin ?
db.activity.find(
  {
    seasons: { 
      $in: ["April", "May", "June"] 
    }
  },
  {
    _id:     0,
    name:    1,
    seasons: 1
  }
);